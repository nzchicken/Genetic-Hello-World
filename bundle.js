/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

const AVAILABLE_CHARACTERS = " ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz012345789!@#$%^&*()_+`~[]{}\|;':\".,/<>?";
const AVAIL_CHAR_LENGTH = AVAILABLE_CHARACTERS.length;
const AVAIL_CHAR_HALF_LENGTH = Math.floor(AVAIL_CHAR_LENGTH / 2);
const CHILD_PRINT_MODULO = 1;

// individual genes
class Gene {
  constructor(code) {
    this.code = code ? code : [];
    this.cost = 9999;
  }

  generateCode(length) {
    this.code = Array.from(Array(length)).map(() => {
      return Math.floor(Math.random() * AVAILABLE_CHARACTERS.length);
    });
  }

  // calculate difference between current gene and other gene. higher costs are exponentially higher)
  calcDiff(otherGene) {
    this.cost = this.code.reduce((a, v, i) => {
      const diff = Math.abs(v - otherGene.code[i]);
      const cost = diff > AVAIL_CHAR_HALF_LENGTH ? -1 * diff + AVAIL_CHAR_LENGTH : diff;
      return a + cost * cost;
    }, 0);
  }

  // mate current gene with another gene
  // pivot may be changed for better results
  mate(gene, mutateChance) {

    const pivot = Math.round(this.code.length / 2) - 1;

    // new children will take half of each gene
    const child1 = new Gene([...this.code.slice(0, pivot), ...gene.code.slice(pivot)]);
    const child2 = new Gene([...gene.code.slice(0, pivot), ...this.code.slice(pivot)]);

    child1.mutate(mutateChance);
    child2.mutate(mutateChance);

    return [child1, child2];
  }

  // randomly mutate gene by a character depending on the percentage
  mutate(percentage) {
    if (Math.random() > percentage) {

      const operation = Math.random();
      const index = Math.floor(Math.random() * this.code.length);
      const upDown = Math.random() > 0.5 ? 1 : -1;
      switch (true) {
        case operation < 0.33:
          var newCode = this.code[index] + upDown;
          var fixedCode = newCode > AVAILABLE_CHARACTERS.length - 1 ? 0 : newCode < 0 ? AVAILABLE_CHARACTERS.length - 1 : newCode;
          this.code[index] = fixedCode;
          break;
        case operation < 0.66:
          var copyPos = index + upDown;
          var newPos = copyPos < 0 ? this.code.length - 1 : copyPos > this.code.length - 1 ? 0 : copyPos;
          this.code[index] = this.code[newPos];
          break;
        default:
          var newCode = this.code[index] + upDown * 2;
          var fixedCode = newCode > AVAILABLE_CHARACTERS.length - 1 ? 0 : newCode < 0 ? AVAILABLE_CHARACTERS.length - 1 : newCode;
          this.code[index] = fixedCode;
          break;
      }
    }
  }

  print(targetChromosome) {
    return this.code.reduce((a, c, i) => {
      return a + '<span class="gene ' + (c === targetChromosome.code[i] ? 'same' : 'diff') + '">' + htmlEscape(AVAILABLE_CHARACTERS[c]) + '</span>';
    }, '');
  }
}

class Population {
  // stores the entire gene population and finds the targetChromosome
  constructor() {
    this.running = false;
    this.targetAchieved = false;
    this.genePool = [];
    this.generationNumber = 0;
    this.targetChromosome = null;
    this.bestGeneTemplate = document.getElementById('bestGenesContainer').innerHTML;
  }

  setPopSize(size) {
    this.genePool = Array.from(Array(size));
  }

  setTarget(target) {
    this.target = target;
    this.targetChromosome = new Gene(target.split('').map(val => AVAILABLE_CHARACTERS.indexOf(val)));
    this.genePool = this.genePool.map(() => {
      const gene = new Gene();
      gene.generateCode(target.length);
      return gene;
    });

    this.genePool.map(gene => {
      gene.calcDiff(this.targetChromosome);
    });
    this.sort();
    this.targetAchieved = false;
  }

  sort() {
    this.genePool.sort((a, b) => a.cost - b.cost);
  }

  start() {
    document.getElementById('bestGenesContainer').innerHTML = this.bestGeneTemplate;
    this.generationNumber = 0;
    this.print();
    this.generationNumber++;
  }

  toggleRunning() {
    this.running = !this.running;

    if (this.running) this.step();
  }

  step() {
    this.generation();

    if (this.genePool[0].cost === 0) {
      this.running = false;
      this.print();
    }
    if (this.running) window.setTimeout(() => {
      this.step();
    }, 0);
  }

  generation() {
    const mutateChance = 0.3;

    const childrenToMate = Math.floor(this.genePool.length / 2 + 0.5); //half rounded up

    const newChildren = Array.from(Array(childrenToMate)).reduce((a, v, i) => {
      const children = this.genePool[0].mate(this.genePool[i + 1], mutateChance);
      children.map(child => {
        child.calcDiff(this.targetChromosome);
      });
      return a.concat(children);
    }, []);

    this.genePool = newChildren.slice(0, this.genePool.length);

    this.sort();

    if (this.generationNumber % CHILD_PRINT_MODULO === 0) this.print();

    this.generationNumber++;
  }

  print() {
    var table = document.getElementById('table');
    table.innerHTML = '';
    table.innerHTML += "<h2>Generation: " + this.generationNumber + "</h2>";
    table.innerHTML += "<ul>";
    for (var i = 0; i < this.genePool.length; i++) {
      table.innerHTML += "<li>" + this.genePool[i].print(this.targetChromosome) + " (" + this.genePool[i].cost + ")";
    }
    table.innerHTML += "</ul>";

    var bestGenes = document.getElementById('bestGenes');
    var newChild = document.createElement('tr');
    newChild.innerHTML = '<td>' + this.generationNumber + '</td><td>' + this.genePool[0].print(this.targetChromosome) + '</td><td>' + this.genePool[0].cost + '</td>';
    bestGenes.appendChild(newChild);
  }
}

document.addEventListener("DOMContentLoaded", () => {
  pop = new Population();
  pop.setPopSize(20);
  const startString = document.getElementById('target').value;
  pop.setTarget(startString);
  document.getElementById("start").addEventListener("click", () => {
    pop.setTarget(pop.target);pop.start();
  });
  document.getElementById("toggleRunning").addEventListener("click", () => {
    pop.toggleRunning();
  });
  document.getElementById("step").addEventListener("click", () => {
    pop.step();
  });
  document.getElementById("setTarget").addEventListener("click", () => {
    pop.setTarget(document.getElementById('target').value);pop.start();
  });
  pop.start();
});

function htmlEscape(str) {
  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/\ /g, '&nbsp;');
}

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMzI3ZDJiOWUyYWM2M2EyZDM1ZjYiLCJ3ZWJwYWNrOi8vLy4vYXBwLmpzIl0sIm5hbWVzIjpbIkFWQUlMQUJMRV9DSEFSQUNURVJTIiwiQVZBSUxfQ0hBUl9MRU5HVEgiLCJsZW5ndGgiLCJBVkFJTF9DSEFSX0hBTEZfTEVOR1RIIiwiTWF0aCIsImZsb29yIiwiQ0hJTERfUFJJTlRfTU9EVUxPIiwiR2VuZSIsImNvbnN0cnVjdG9yIiwiY29kZSIsImNvc3QiLCJnZW5lcmF0ZUNvZGUiLCJBcnJheSIsImZyb20iLCJtYXAiLCJyYW5kb20iLCJjYWxjRGlmZiIsIm90aGVyR2VuZSIsInJlZHVjZSIsImEiLCJ2IiwiaSIsImRpZmYiLCJhYnMiLCJtYXRlIiwiZ2VuZSIsIm11dGF0ZUNoYW5jZSIsInBpdm90Iiwicm91bmQiLCJjaGlsZDEiLCJzbGljZSIsImNoaWxkMiIsIm11dGF0ZSIsInBlcmNlbnRhZ2UiLCJvcGVyYXRpb24iLCJpbmRleCIsInVwRG93biIsIm5ld0NvZGUiLCJmaXhlZENvZGUiLCJjb3B5UG9zIiwibmV3UG9zIiwicHJpbnQiLCJ0YXJnZXRDaHJvbW9zb21lIiwiYyIsImh0bWxFc2NhcGUiLCJQb3B1bGF0aW9uIiwicnVubmluZyIsInRhcmdldEFjaGlldmVkIiwiZ2VuZVBvb2wiLCJnZW5lcmF0aW9uTnVtYmVyIiwiYmVzdEdlbmVUZW1wbGF0ZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJzZXRQb3BTaXplIiwic2l6ZSIsInNldFRhcmdldCIsInRhcmdldCIsInNwbGl0IiwidmFsIiwiaW5kZXhPZiIsInNvcnQiLCJiIiwic3RhcnQiLCJ0b2dnbGVSdW5uaW5nIiwic3RlcCIsImdlbmVyYXRpb24iLCJ3aW5kb3ciLCJzZXRUaW1lb3V0IiwiY2hpbGRyZW5Ub01hdGUiLCJuZXdDaGlsZHJlbiIsImNoaWxkcmVuIiwiY2hpbGQiLCJjb25jYXQiLCJ0YWJsZSIsImJlc3RHZW5lcyIsIm5ld0NoaWxkIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInBvcCIsInN0YXJ0U3RyaW5nIiwidmFsdWUiLCJzdHIiLCJTdHJpbmciLCJyZXBsYWNlIl0sIm1hcHBpbmdzIjoiO0FBQUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLG1EQUEyQyxjQUFjOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLG1DQUEyQiwwQkFBMEIsRUFBRTtBQUN2RCx5Q0FBaUMsZUFBZTtBQUNoRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4REFBc0QsK0RBQStEOztBQUVySDtBQUNBOztBQUVBO0FBQ0E7Ozs7Ozs7QUNoRUEsTUFBTUEsdUJBQXVCLCtGQUE3QjtBQUNBLE1BQU1DLG9CQUFvQkQscUJBQXFCRSxNQUEvQztBQUNBLE1BQU1DLHlCQUF5QkMsS0FBS0MsS0FBTCxDQUFXSixvQkFBa0IsQ0FBN0IsQ0FBL0I7QUFDQSxNQUFNSyxxQkFBcUIsQ0FBM0I7O0FBRUE7QUFDQSxNQUFNQyxJQUFOLENBQVc7QUFDVEMsY0FBWUMsSUFBWixFQUFrQjtBQUNoQixTQUFLQSxJQUFMLEdBQVlBLE9BQU9BLElBQVAsR0FBYyxFQUExQjtBQUNBLFNBQUtDLElBQUwsR0FBWSxJQUFaO0FBQ0Q7O0FBRURDLGVBQWFULE1BQWIsRUFBcUI7QUFDbkIsU0FBS08sSUFBTCxHQUFZRyxNQUFNQyxJQUFOLENBQVdELE1BQU1WLE1BQU4sQ0FBWCxFQUEwQlksR0FBMUIsQ0FBOEIsTUFBTTtBQUFFLGFBQU9WLEtBQUtDLEtBQUwsQ0FBV0QsS0FBS1csTUFBTCxLQUFnQmYscUJB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Q0FBd0IsT0FBeEIsRUFBaUMyQixnQkFBakMsQ0FBa0QsT0FBbEQsRUFBMkQsTUFBTTtBQUFFQyxRQUFJeEIsU0FBSixDQUFjd0IsSUFBSXZCLE1BQWxCLEVBQTJCdUIsSUFBSWpCLEtBQUo7QUFBYyxHQUE1RztBQUNBWixXQUFTQyxjQUFULENBQXdCLGVBQXhCLEVBQXlDMkIsZ0JBQXpDLENBQTBELE9BQTFELEVBQW1FLE1BQU07QUFBRUMsUUFBSWhCLGFBQUo7QUFBc0IsR0FBakc7QUFDQWIsV0FBU0MsY0FBVCxDQUF3QixNQUF4QixFQUFnQzJCLGdCQUFoQyxDQUFpRCxPQUFqRCxFQUEwRCxNQUFNO0FBQUVDLFFBQUlmLElBQUo7QUFBYSxHQUEvRTtBQUNBZCxXQUFTQyxjQUFULENBQXdCLFdBQXhCLEVBQXFDMkIsZ0JBQXJDLENBQXNELE9BQXRELEVBQStELE1BQU07QUFBRUMsUUFBSXhCLFNBQUosQ0FBY0wsU0FBU0MsY0FBVCxDQUF3QixRQUF4QixFQUFrQzhCLEtBQWhELEVBQXdERixJQUFJakIsS0FBSjtBQUFjLEdBQTdJO0FBQ0FpQixNQUFJakIsS0FBSjtBQUNELENBVkQ7O0FBWUEsU0FBU25CLFVBQVQsQ0FBb0J1QyxHQUFwQixFQUF5QjtBQUN2QixTQUFPQyxPQUFPRCxHQUFQLEVBQVlFLE9BQVosQ0FBb0IsSUFBcEIsRUFBMEIsT0FBMUIsRUFBbUNBLE9BQW5DLENBQTJDLElBQTNDLEVBQWlELE1BQWpELEVBQXlEQSxPQUF6RCxDQUFpRSxJQUFqRSxFQUF1RSxNQUF2RSxFQUErRUEsT0FBL0UsQ0FBdUYsSUFBdkYsRUFBNkYsUUFBN0YsRUFBdUdBLE9BQXZHLENBQStHLEtBQS9HLEVBQXNILFFBQXRILENBQVA7QUFDRCxDIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGlkZW50aXR5IGZ1bmN0aW9uIGZvciBjYWxsaW5nIGhhcm1vbnkgaW1wb3J0cyB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHRcbiBcdF9fd2VicGFja19yZXF1aXJlX18uaSA9IGZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiB2YWx1ZTsgfTtcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgMzI3ZDJiOWUyYWM2M2EyZDM1ZjYiLCJjb25zdCBBVkFJTEFCTEVfQ0hBUkFDVEVSUyA9IFwiIEFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU3ODkhQCMkJV4mKigpXytgfltde31cXHw7JzpcXFwiLiwvPD4/XCI7XG5jb25zdCBBVkFJTF9DSEFSX0xFTkdUSCA9IEFWQUlMQUJMRV9DSEFSQUNURVJTLmxlbmd0aDtcbmNvbnN0IEFWQUlMX0NIQVJfSEFMRl9MRU5HVEggPSBNYXRoLmZsb29yKEFWQUlMX0NIQVJfTEVOR1RILzIpO1xuY29uc3QgQ0hJTERfUFJJTlRfTU9EVUxPID0gMTtcblxuLy8gaW5kaXZpZHVhbCBnZW5lc1xuY2xhc3MgR2VuZSB7XG4gIGNvbnN0cnVjdG9yKGNvZGUpIHtcbiAgICB0aGlzLmNvZGUgPSBjb2RlID8gY29kZSA6IFtdO1xuICAgIHRoaXMuY29zdCA9IDk5OTk7XG4gIH1cblxuICBnZW5lcmF0ZUNvZGUobGVuZ3RoKSB7XG4gICAgdGhpcy5jb2RlID0gQXJyYXkuZnJvbShBcnJheShsZW5ndGgpKS5tYXAoKCkgPT4geyByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogQVZBSUxBQkxFX0NIQVJBQ1RFUlMubGVuZ3RoKTsgfSk7XG4gIH1cblxuICAvLyBjYWxjdWxhdGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgZ2VuZSBhbmQgb3RoZXIgZ2VuZS4gaGlnaGVyIGNvc3RzIGFyZSBleHBvbmVudGlhbGx5IGhpZ2hlcilcbiAgY2FsY0RpZmYob3RoZXJHZW5lKSB7XG4gICAgdGhpcy5jb3N0ID0gdGhpcy5jb2RlLnJlZHVjZSgoYSwgdiwgaSkgPT4ge1xuICAgICAgY29uc3QgZGlmZiA9IE1hdGguYWJzKHYgLSBvdGhlckdlbmUuY29kZVtpXSk7XG4gICAgICBjb25zdCBjb3N0ID0gZGlmZiA+IEFWQUlMX0NIQVJfSEFMRl9MRU5HVEggPyAtMSAqIGRpZmYgKyBBVkFJTF9DSEFSX0xFTkdUSCA6IGRpZmY7XG4gICAgICByZXR1cm4gYSArIChjb3N0ICogY29zdCk7XG4gICAgfSwgMCk7XG4gIH1cblxuICAvLyBtYXRlIGN1cnJlbnQgZ2VuZSB3aXRoIGFub3RoZXIgZ2VuZVxuICAvLyBwaXZvdCBtYXkgYmUgY2hhbmdlZCBmb3IgYmV0dGVyIHJlc3VsdHNcbiAgbWF0ZShnZW5lLCBtdXRhdGVDaGFuY2UpIHtcblxuICAgIGNvbnN0IHBpdm90ID0gTWF0aC5yb3VuZCh0aGlzLmNvZGUubGVuZ3RoLzIpIC0gMTtcblxuICAgIC8vIG5ldyBjaGlsZHJlbiB3aWxsIHRha2UgaGFsZiBvZiBlYWNoIGdlbmVcbiAgICBjb25zdCBjaGlsZDEgPSBuZXcgR2VuZShbIC4uLnRoaXMuY29kZS5zbGljZSgwLCBwaXZvdCksIC4uLmdlbmUuY29kZS5zbGljZShwaXZvdCkgXSk7XG4gICAgY29uc3QgY2hpbGQyID0gbmV3IEdlbmUoWyAuLi5nZW5lLmNvZGUuc2xpY2UoMCwgcGl2b3QpLCAuLi50aGlzLmNvZGUuc2xpY2UocGl2b3QpIF0pO1xuXG4gICAgY2hpbGQxLm11dGF0ZShtdXRhdGVDaGFuY2UpO1xuICAgIGNoaWxkMi5tdXRhdGUobXV0YXRlQ2hhbmNlKTtcblxuICAgIHJldHVybiBbIGNoaWxkMSwgY2hpbGQyIF07XG4gIH1cblxuICAvLyByYW5kb21seSBtdXRhdGUgZ2VuZSBieSBhIGNoYXJhY3RlciBkZXBlbmRpbmcgb24gdGhlIHBlcmNlbnRhZ2VcbiAgbXV0YXRlKHBlcmNlbnRhZ2UpIHtcbiAgICBpZiAoTWF0aC5yYW5kb20oKSA+IHBlcmNlbnRhZ2UpIHtcblxuICAgICAgY29uc3Qgb3BlcmF0aW9uID0gTWF0aC5yYW5kb20oKTtcbiAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5jb2RlLmxlbmd0aCk7XG4gICAgICBjb25zdCB1cERvd24gPSBNYXRoLnJhbmRvbSgpID4gMC41ID8gMSA6IC0xO1xuICAgICAgc3dpdGNoKHRydWUpIHtcbiAgICAgICAgY2FzZSAob3BlcmF0aW9uIDwgMC4zMyk6XG4gICAgICAgICAgdmFyIG5ld0NvZGUgPSB0aGlzLmNvZGVbaW5kZXhdICsgdXBEb3duO1xuICAgICAgICAgIHZhciBmaXhlZENvZGUgPSBuZXdDb2RlID4gQVZBSUxBQkxFX0NIQVJBQ1RFUlMubGVuZ3RoIC0gMSA/IDAgOiAobmV3Q29kZSA8IDAgPyBBVkFJTEFCTEVfQ0hBUkFDVEVSUy5sZW5ndGggLSAxOiBuZXdDb2RlKTtcbiAgICAgICAgICB0aGlzLmNvZGVbaW5kZXhdID0gZml4ZWRDb2RlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIChvcGVyYXRpb24gPCAwLjY2KTpcbiAgICAgICAgICB2YXIgY29weVBvcyA9IGluZGV4ICsgdXBEb3duO1xuICAgICAgICAgIHZhciBuZXdQb3MgPSBjb3B5UG9zIDwgMCA/IHRoaXMuY29kZS5sZW5ndGggLSAxIDogKGNvcHlQb3MgPiB0aGlzLmNvZGUubGVuZ3RoIC0gMSA/IDAgOiBjb3B5UG9zKTtcbiAgICAgICAgICB0aGlzLmNvZGVbaW5kZXhdID0gdGhpcy5jb2RlW25ld1Bvc107XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdmFyIG5ld0NvZGUgPSB0aGlzLmNvZGVbaW5kZXhdICsgdXBEb3duKjI7XG4gICAgICAgICAgdmFyIGZpeGVkQ29kZSA9IG5ld0NvZGUgPiBBVkFJTEFCTEVfQ0hBUkFDVEVSUy5sZW5ndGggLSAxID8gMCA6IChuZXdDb2RlIDwgMCA/IEFWQUlMQUJMRV9DSEFSQUNURVJTLmxlbmd0aCAtIDE6IG5ld0NvZGUpO1xuICAgICAgICAgIHRoaXMuY29kZVtpbmRleF0gPSBmaXhlZENvZGU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpbnQodGFyZ2V0Q2hyb21vc29tZSkge1xuICAgIHJldHVybiB0aGlzLmNvZGUucmVkdWNlKChhLGMsaSkgPT4ge1xuICAgICAgcmV0dXJuIGEgKyAnPHNwYW4gY2xhc3M9XCJnZW5lICcgKyAoYyA9PT0gdGFyZ2V0Q2hyb21vc29tZS5jb2RlW2ldID8gJ3NhbWUnIDogJ2RpZmYnKSArICdcIj4nICsgaHRtbEVzY2FwZShBVkFJTEFCTEVfQ0hBUkFDVEVSU1tjXSkgKyAnPC9zcGFuPic7XG4gICAgfSwgJycpXG4gIH1cbn1cblxuY2xhc3MgUG9wdWxhdGlvbiB7XG4gIC8vIHN0b3JlcyB0aGUgZW50aXJlIGdlbmUgcG9wdWxhdGlvbiBhbmQgZmluZHMgdGhlIHRhcmdldENocm9tb3NvbWVcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgdGhpcy50YXJnZXRBY2hpZXZlZCA9IGZhbHNlO1xuICAgIHRoaXMuZ2VuZVBvb2wgPSBbXTtcbiAgICB0aGlzLmdlbmVyYXRpb25OdW1iZXIgPSAwO1xuICAgIHRoaXMudGFyZ2V0Q2hyb21vc29tZSA9IG51bGw7XG4gICAgdGhpcy5iZXN0R2VuZVRlbXBsYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jlc3RHZW5lc0NvbnRhaW5lcicpLmlubmVySFRNTDtcbiAgfVxuXG4gIHNldFBvcFNpemUoc2l6ZSkge1xuICAgIHRoaXMuZ2VuZVBvb2wgPSBBcnJheS5mcm9tKEFycmF5KHNpemUpKTtcbiAgfVxuXG4gIHNldFRhcmdldCh0YXJnZXQpIHtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnRhcmdldENocm9tb3NvbWUgPSBuZXcgR2VuZSh0YXJnZXQuc3BsaXQoJycpLm1hcCh2YWwgPT4gQVZBSUxBQkxFX0NIQVJBQ1RFUlMuaW5kZXhPZih2YWwpKSk7XG4gICAgdGhpcy5nZW5lUG9vbCA9IHRoaXMuZ2VuZVBvb2wubWFwKCgpID0+IHtcbiAgICAgIGNvbnN0IGdlbmUgPSBuZXcgR2VuZSgpO1xuICAgICAgZ2VuZS5nZW5lcmF0ZUNvZGUodGFyZ2V0Lmxlbmd0aCk7XG4gICAgICByZXR1cm4gZ2VuZTtcbiAgICB9KTtcblxuICAgIHRoaXMuZ2VuZVBvb2wubWFwKGdlbmUgPT4geyBnZW5lLmNhbGNEaWZmKHRoaXMudGFyZ2V0Q2hyb21vc29tZSkgfSk7XG4gICAgdGhpcy5zb3J0KCk7XG4gICAgdGhpcy50YXJnZXRBY2hpZXZlZCA9IGZhbHNlO1xuICB9XG5cbiAgc29ydCgpIHtcbiAgICB0aGlzLmdlbmVQb29sLnNvcnQoKGEsIGIpID0+IGEuY29zdCAtIGIuY29zdCk7XG4gIH1cblxuICBzdGFydCgpIHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmVzdEdlbmVzQ29udGFpbmVyJykuaW5uZXJIVE1MID0gdGhpcy5iZXN0R2VuZVRlbXBsYXRlO1xuICAgIHRoaXMuZ2VuZXJhdGlvbk51bWJlciA9IDA7XG4gICAgdGhpcy5wcmludCgpO1xuICAgIHRoaXMuZ2VuZXJhdGlvbk51bWJlcisrO1xuICB9XG5cbiAgdG9nZ2xlUnVubmluZygpIHtcbiAgICB0aGlzLnJ1bm5pbmcgPSAhdGhpcy5ydW5uaW5nO1xuXG4gICAgaWYgKHRoaXMucnVubmluZykgdGhpcy5zdGVwKCk7XG4gIH1cblxuICBzdGVwKCkge1xuICAgIHRoaXMuZ2VuZXJhdGlvbigpO1xuXG4gICAgaWYgKHRoaXMuZ2VuZVBvb2xbMF0uY29zdCA9PT0gMCkge1xuICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLnByaW50KCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJ1bm5pbmcpIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHsgdGhpcy5zdGVwKCkgfSwgMCk7XG4gIH1cblxuICBnZW5lcmF0aW9uKCkge1xuICAgIGNvbnN0IG11dGF0ZUNoYW5jZSA9IDAuMztcblxuICAgIGNvbnN0IGNoaWxkcmVuVG9NYXRlID0gTWF0aC5mbG9vcih0aGlzLmdlbmVQb29sLmxlbmd0aCAvIDIgKyAwLjUpOyAvL2hhbGYgcm91bmRlZCB1cFxuXG4gICAgY29uc3QgbmV3Q2hpbGRyZW4gPSBBcnJheS5mcm9tKEFycmF5KGNoaWxkcmVuVG9NYXRlKSkucmVkdWNlKChhLCB2LCBpKSA9PiB7XG4gICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuZ2VuZVBvb2xbMF0ubWF0ZSh0aGlzLmdlbmVQb29sW2krMV0sIG11dGF0ZUNoYW5jZSk7XG4gICAgICBjaGlsZHJlbi5tYXAoY2hpbGQgPT4geyBjaGlsZC5jYWxjRGlmZih0aGlzLnRhcmdldENocm9tb3NvbWUpIH0pO1xuICAgICAgcmV0dXJuIGEuY29uY2F0KGNoaWxkcmVuKTtcbiAgICB9LCBbXSk7XG5cblxuICAgIHRoaXMuZ2VuZVBvb2wgPSBuZXdDaGlsZHJlbi5zbGljZSgwLCB0aGlzLmdlbmVQb29sLmxlbmd0aCk7XG5cbiAgICB0aGlzLnNvcnQoKTtcblxuICAgIGlmICh0aGlzLmdlbmVyYXRpb25OdW1iZXIgJSBDSElMRF9QUklOVF9NT0RVTE8gPT09IDApIHRoaXMucHJpbnQoKTtcblxuICAgIHRoaXMuZ2VuZXJhdGlvbk51bWJlcisrO1xuICB9XG5cbiAgcHJpbnQoKSB7XG4gICAgdmFyIHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYmxlJylcbiAgICB0YWJsZS5pbm5lckhUTUwgPSAnJztcbiAgICB0YWJsZS5pbm5lckhUTUwgKz0gKFwiPGgyPkdlbmVyYXRpb246IFwiICsgdGhpcy5nZW5lcmF0aW9uTnVtYmVyICsgXCI8L2gyPlwiKTtcbiAgICB0YWJsZS5pbm5lckhUTUwgKz0gKFwiPHVsPlwiKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2VuZVBvb2wubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRhYmxlLmlubmVySFRNTCArPSAoXCI8bGk+XCIgKyB0aGlzLmdlbmVQb29sW2ldLnByaW50KHRoaXMudGFyZ2V0Q2hyb21vc29tZSkgKyBcIiAoXCIgKyB0aGlzLmdlbmVQb29sW2ldLmNvc3QgKyBcIilcIik7XG4gICAgfVxuICAgIHRhYmxlLmlubmVySFRNTCArPSAoXCI8L3VsPlwiKTtcblxuICAgIHZhciBiZXN0R2VuZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmVzdEdlbmVzJyk7XG4gICAgdmFyIG5ld0NoaWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICBuZXdDaGlsZC5pbm5lckhUTUwgPSAnPHRkPicgKyB0aGlzLmdlbmVyYXRpb25OdW1iZXIgKyAnPC90ZD48dGQ+JyArIHRoaXMuZ2VuZVBvb2xbMF0ucHJpbnQodGhpcy50YXJnZXRDaHJvbW9zb21lKSArICc8L3RkPjx0ZD4nICsgdGhpcy5nZW5lUG9vbFswXS5jb3N0ICsgJzwvdGQ+JztcbiAgICBiZXN0R2VuZXMuYXBwZW5kQ2hpbGQobmV3Q2hpbGQpO1xuICB9O1xufVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIHBvcCA9IG5ldyBQb3B1bGF0aW9uKCk7XG4gIHBvcC5zZXRQb3BTaXplKDIwKTtcbiAgY29uc3Qgc3RhcnRTdHJpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFyZ2V0JykudmFsdWU7XG4gIHBvcC5zZXRUYXJnZXQoc3RhcnRTdHJpbmcpO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXJ0XCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHBvcC5zZXRUYXJnZXQocG9wLnRhcmdldCk7IHBvcC5zdGFydCgpOyB9KTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b2dnbGVSdW5uaW5nXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHBvcC50b2dnbGVSdW5uaW5nKCk7IH0pO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0ZXBcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgcG9wLnN0ZXAoKTsgfSk7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2V0VGFyZ2V0XCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHBvcC5zZXRUYXJnZXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhcmdldCcpLnZhbHVlKTsgcG9wLnN0YXJ0KCk7IH0pO1xuICBwb3Auc3RhcnQoKTtcbn0pO1xuXG5mdW5jdGlvbiBodG1sRXNjYXBlKHN0cikge1xuICByZXR1cm4gU3RyaW5nKHN0cikucmVwbGFjZSgvJi9nLCAnJmFtcDsnKS5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpLnJlcGxhY2UoL1wiL2csICcmcXVvdDsnKS5yZXBsYWNlKC9cXCAvZywgJyZuYnNwOycpO1xufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vYXBwLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==